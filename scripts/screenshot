#!/usr/bin/env bash

scrotdir=scrots

scrotname () {
	time="`date +%Y-%m-%d_%H:%M:%S`.png"
	name=$(echo -e "" | bash $HOME/scripts/i3menu "Choose scrot name:")

	if [[ -z $name ]]; then
		scrotname=$time
	else
		scrotname="${name}.png"
	fi
}

confirmscrot () {
	action=$(echo -e "Save\nNew\nClipboard" | bash $HOME/scripts/i3menu "Save?")
	if [[ $action == "Save" ]]; then
		scrotname
		mv $HOME/Pictures/scrots/tmp.png $HOME/Pictures/scrots/${scrotname}
		notify-send "${scrotname} saved to ~/Pictures/${scrotdir}" -i ~/Pictures/${scrotdir}/${scrotname}
	elif [[ $action == "New" ]]; then
		tmpscrot
	elif [[ $action == "Clipboard" ]]; then
		clipboard
	else
		rm $HOME/Pictures/${scrotdir}/tmp.png
	fi
}

tmpscrot () {
	scrot_type=$(echo -e "Fullscreen\nSelection" | bash $HOME/scripts/i3menu "Scrot type?:")

	if [[ $scrot_type == "Fullscreen" ]]; then
		sleep .25
		maim --hidecursor $HOME/Pictures/${scrotdir}/tmp.png
	elif [[ $scrot_type == "Selection" ]]; then
		maim --select --hidecursor $HOME/Pictures/${scrotdir}/tmp.png
	else
		:
	fi

	sxiv $HOME/Pictures/${scrotdir}/tmp.png 
	confirmscrot
}

clipboard () {
	xclip -selection clipboard -t image/png -i $HOME/Pictures/${scrotdir}/tmp.png
	notify-send "Copied scrot to Clipboard" -i ~/Pictures/${scrotdir}/tmp.png
	rm $HOME/Pictures/${scrotdir}/tmp.png
}

tmpscrot
