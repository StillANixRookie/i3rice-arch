#!/usr/bin/env bash

case $1 in
	inc)  pactl set-sink-volume 0 +2%  ;;
	dec)  pactl set-sink-volume 0 -2%  ;;
	mute) pactl set-sink-mute 0 toggle ;;
esac

RVL=$(amixer get Master | tail -n 1 | grep %)
VOL=${RVL%\%*}
VOL=${VOL#*[}
STT=${RVL%]*}
STT=${STT##*[}
ICN="%{T1}%{T-}"
BCL=$(themer -v "acb ")
FCL=$(themer -v "fg0 ")

update () {
	_VOL=$VOL
	[[ $VOL == 0 ]]     && ICN="%{T1}%{T-}"
	[[ $VOL -ge 30 ]]   && ICN="%{T1}%{T-}"
	[[ $VOL -ge 60 ]]   && ICN="%{T1}%{T-}" && BCL="#ffcc00"
	[[ $VOL -ge 80 ]]   && BCL="#cc0000"
	[[ $STT == "off" ]] && ICN="%{T1}%{T-}" && _VOL=" ---"
	FSTR="%{B${BCL}}%{F${FCL}} \
%{A4:i3volume inc:}%{A5:i3volume dec:}\
%{A1:i3volume mute:}${ICN} ${_VOL}%{A}%{A}%{A}  \
%{B- F-}"
	pbcat -m volume -v "$FSTR"
}

if [[ $VOL -ge 100 ]]; then
	BAR="████████████████████"
elif [[ $VOL -ge 90 ]]; then                                       
	BAR="██████████████████"
elif [[ $VOL -ge 80 ]]; then                                       
	BAR="████████████████"
elif [[ $VOL -ge 70 ]]; then                                       
	BAR="██████████████"
elif [[ $VOL -ge 60 ]]; then                                       
	BAR="████████████"
elif [[ $VOL -ge 50 ]]; then                                       
	BAR="██████████"
elif [[ $VOL -ge 40 ]]; then                                       
	BAR="████████"
elif [[ $VOL -ge 30 ]]; then                                       
	BAR="██████"
elif [[ $VOL -ge 20 ]]; then                                       
	BAR="████"
elif [[ $VOL -ge 10 ]]; then                                       
	BAR="██"
elif [[ $VOL -lt 10 ]]; then                                       
	BAR=""
else
	BAR="MUTED"
fi

dunstify -r 1234 --raw_icon=${USER_SCR_DIR}pic/speaker-full.png " ${VOL}% $BAR "
update
