#!/usr/bin/env bash

# OA: Gavin Vales
# CREATED: Sat 16 Mar 20:08:40 GMT 2019
# requires dmenu-manjaro

ttlbr=24
brdr=4
prmt="${1}"
wnloc=$(xdotool getactivewindow getwindowgeometry | grep 'Position' | awk '{print $2}')
wngeo=$(xdotool getactivewindow getwindowgeometry | grep 'Geometry' | awk '{print $2}')
wnX=${wnloc%,*}
wnY=${wnloc#*,}
wnW=${wngeo%x*}
wnH=${wngeo#*x}
msX=$(xdotool getmouselocation | awk '{print $1}')
msY=$(xdotool getmouselocation | awk '{print $2}')
mon=$(xdotool getmouselocation | awk '{print $3}')

bkd=$(xrdb -query | grep '*color8' | awk '{print $NF}')
wtl=$(xrdb -query | grep '*color15' | awk '{print $NF}')
blu=$(xrdb -query | grep '*color4' | awk '{print $NF}')
fnt=$(xrdb -query | grep 'URxvt.font' | awk '{print $NF}')
fnt=${fnt%:*}
fnt=${fnt##*:}

dmenuthm="-fn "${fnt}:size=11" -nb "$bkd" -nf "$wtl" -sf "$bkd" -sb "$blu""
msloc="-xoffset ${msX:2} -yoffset ${msY:2}"
wnloc="-xoffset $(expr $wnX - $brdr) -yoffset $(expr $wnY - $ttlbr)"
dmenuloc="-x $(expr $wnX - $brdr) -y $(expr $wnY - $ttlbr)"

centre () {
	rofi -dmenu -monitor ${mon:7} -location 0 -lines 10 -p "${prmt}"
}

start-button () {
	rofi -show drun -monitor ${mon:7} -location 0 -lines 10 -p "${prmt}"
}

dmenu () {
	dmenu_run $dmenuloc $dmenuthm -w $(expr $wnW + $brdr + $brdr) -h $ttlbr
}

if [[ ${prmt} == "-run" ]]; then
	dmenu
else
	centre
fi

#while getopts :dsptmwlxy: opts; do
#	case $opts in
#		d)
#			<++>
#			;;
#		s)
#			<++>
#			;;
#		p)
#			<++>
#			;;
#		t)
#			<++>
#			;;
#		m)
#			<++>
#			;;
#		w)
#			<++>
#			;;
#		l)
#			<++>
#			;;
#		x)
#			<++>
#			;;
#		y)
#			<++>
#			;;
#	esac
#done
