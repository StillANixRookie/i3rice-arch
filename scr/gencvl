#!/usr/bin/env bash

# OA: Gavin Vales
# CREATED: Mon 22 Jul 19:53:50 BST 2019

CLDIR=$XDG_DOCUMENTS_DIR/mine/cvl
PLT=$XDG_TEMPLATES_DIR/md/cvl.md
EDITOR="gvim -f"

help () {
cat << 'EOB'
# NAME

__gencvl__ - job application cover letter generator using `markdown` and `pandoc`

# SYNOPSIS

```
gencvl <name>
gencvl --help|-h
```

# OPTIONS

`<name>`  
`<name>` of coverletter

`--help|-h`  
Print this help

EOB
echo "$1"
exit
}

while true; do
	case $1 in
		--help ) help ;;
		-h     ) help | sed -n "/# SYNOPSIS/,/#/p" | sed '/^#/d;/^$/d;/```/d' && exit ;;
		-- ) shift ; break ;;
		*  ) break         ;;
	esac
	shift
done

TIT="${@:-}"

[[ -n $TIT ]] || TIT="$(echo "" | i3menu -c yellow -w 500 -p "Enter title: ")"
[[ -n $TIT ]] || help

FLD="$(echo "${TIT}" | sed 's/\ //g')"
[[ ! -d $CLDIR ]] && mkdir $CLDIR
cd $CLDIR
[[ ! -d $FLD ]] && mkdir $FLD
cd $FLD
cp $PLT ${FLD}.md
sed -e "s/TITLE/$TIT/g" -i ${FLD}.md
$EDITOR ${FLD}.md
compiler ${FLD}.md
raux
