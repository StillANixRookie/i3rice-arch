#!/bin/bash

DEF=.defaults
LST=.theme_list
main () {
	rm $LST
	thms=$(ls -l | grep -v "^total" | awk '{print $NF}')
	for i in $thms; do
		eval $(awk '
			$1 ~ /^fg0$/  { fg0=$2; };
			$1 ~ /^bg0$/  { bg0=$2; };
			$1 ~ /^acc$/  { acc=$2; };
			fg0 ~ /\$/ { gsub(/^\$/, "", fg0); };
			bg0 ~ /\$/ { gsub(/^\$/, "", bg0); };
			acc ~ /\$/ { gsub(/^\$/, "", acc); };
			$1 ~ "^" fg0 "$" { fg0=$2; };
			$1 ~ "^" bg0 "$" { bg0=$2; };
			$1 ~ "^" acc "$" { acc=$2; };
			END {
				print "bg0=" bg0;
				print "fg0=" fg0;
				print "acc=" acc;
				}
			' $i)
		[[ ! $fg0 =~ "#" ]] && fg0=$(cat $DEF | sed "/^"${fg0/\$/}\ "/!d;s/[^ ]* *//")
		[[ ! $acc =~ "#" ]] && acc=$(cat $DEF | sed "/^"${acc/\$/}\ "/!d;s/[^ ]* *//")
		[[ ! $bg0 =~ "#" ]] && bg0=$(cat $DEF | sed "/^"${bg0/\$/}\ "/!d;s/[^ ]* *//")
		echo "<span background=\"$acc\">   </span>\
<span foreground=\"$fg0\" background=\"$bg0\"> $i </span>" >> $LST
	done
}

main
